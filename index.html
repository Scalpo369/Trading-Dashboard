<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js"></script>
</head>

<body>
    <div class="dashboard">
        <header class="header">
            <h1>Crypto Trading Dashboard</h1>
        </header>

        <!-- Sezione Wallet -->
        <div class="wallet-info">
            <span>Wallet Address: <span id="wallet-address">Connetti Wallet</span></span>
            <button id="connect-wallet" class="btn-primary">Connetti Wallet</button>
        </div>

        <!-- Sezione Dati di Mercato -->
        <div class="market-data">
            <div class="market-item">
                <h3>Bitcoin (BTC)</h3>
                <p>Prezzo: <span id="btc-price">-</span></p>
            </div>
            <div class="market-item">
                <h3>Ethereum (ETH)</h3>
                <p>Prezzo: <span id="eth-price">-</span></p>
            </div>
            <div class="market-item">
                <h3>Solana (SOL)</h3>
                <p>Prezzo: <span id="sol-price">-</span></p>
            </div>
        </div>

        <!-- Sezione Grafico Prezzi -->
        <div class="section chart">
            <h2>Grafico Prezzi</h2>
            <canvas id="priceChart" width="400" height="200"></canvas>
        </div>

        <!-- Sezione Order Book -->
        <div class="order-entry">
            <h2>Fai un Ordine</h2>
            <form id="order-form">
                <select id="order-type">
                    <option value="buy">Compra</option>
                    <option value="sell">Vendi</option>
                </select>
                <input type="number" id="order-amount" placeholder="Quantità" required>
                <input type="number" id="order-price" placeholder="Prezzo" required>
                <button type="submit">Aggiungi Ordine</button>
            </form>
        </div>

        <!-- Sezione Order Book -->
        <div class="section order-book">
            <h2>Order Book</h2>
            <table class="order-table">
                <tr>
                    <th>Tipo</th>
                    <th>Prezzo</th>
                    <th>Quantità</th>
                </tr>
            </table>
        </div>
    </div>

    <script>
        // Funzione per connettere il wallet Phantom
        async function connectWallet() {
            if (window.solana && window.solana.isPhantom) {
                try {
                    const response = await window.solana.connect();
                    document.getElementById('wallet-address').textContent = response.publicKey.toString();
                    document.getElementById('connect-wallet').disabled = true;
                } catch (err) {
                    alert("Errore nella connessione al wallet");
                }
            } else {
                alert("Phantom Wallet non trovato. Installa Phantom per continuare.");
            }
        }

        document.getElementById('connect-wallet').addEventListener('click', connectWallet);

        // Funzione per ottenere i dati di mercato
        async function getMarketData() {
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd');
            const data = await response.json();

            document.getElementById('btc-price').textContent = `$${data.bitcoin.usd}`;
            document.getElementById('eth-price').textContent = `$${data.ethereum.usd}`;
            document.getElementById('sol-price').textContent = `$${data.solana.usd}`;
        }

        // Funzione per aggiornare dinamicamente il grafico
        function updateChartData() {
            const updatedData = [23000, 23500, 24000, 24500, 25500, 26500, 27000]; // Example dynamic prices

            priceChart.data.datasets[0].data = updatedData;
            priceChart.update();
        }

        // Inizializza il grafico dei prezzi
        const ctx = document.getElementById('priceChart').getContext('2d');
        const priceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab', 'Dom'],
                datasets: [{
                    label: 'Prezzo BTC/USD',
                    data: [21000, 21500, 22000, 22500, 21800, 23000, 23500],
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                }
            }
        });

        // Funzione per aggiungere un ordine all'order book
        document.getElementById('order-form').addEventListener('submit', function (event) {
            event.preventDefault();

            const orderType = document.getElementById('order-type').value;
            const orderAmount = document.getElementById('order-amount').value;
            const orderPrice = document.getElementById('order-price').value;

            const orderTable = document.querySelector('.order-table');
            const newRow = orderTable.insertRow();
            const typeCell = newRow.insertCell(0);
            typeCell.textContent = orderType === 'buy' ? 'Compra' : 'Vendi';

            const priceCell = newRow.insertCell(1);
            priceCell.textContent = `$${orderPrice}`;

            const amountCell = newRow.insertCell(2);
            amountCell.textContent = orderAmount;

            document.getElementById('order-form').reset();
        });

        // Aggiorna i dati e il grafico ogni 30 secondi
        setInterval(getMarketData, 30000);
        setInterval(updateChartData, 30000);

        // Inizializzare i dati di mercato all'avvio
        getMarketData();
    </script>
</body>

</html>
