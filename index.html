<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard - Solana</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.32.1/dist/web3.min.js"></script>
</head>
<body>
    <div id="content">
        <h1>Trading Dashboard</h1>

        <!-- Connetti il wallet Phantom -->
        <button id="connect-wallet-btn">Connect Wallet</button>
        <button id="send-order-btn" style="display:none;">Send Trade Order</button>
        <p id="wallet-address"></p>

        <!-- Prezzo di Bitcoin in tempo reale -->
        <h2>Real-Time Bitcoin Price</h2>
        <p id="bitcoin-price">Loading...</p>
    </div>

    <script>
        let walletAddress = null;

        // Pulsante per connettere il wallet Phantom
        const connectWalletButton = document.getElementById("connect-wallet-btn");
        const sendOrderButton = document.getElementById("send-order-btn");
        const walletAddressDisplay = document.getElementById("wallet-address");

        // Funzione per connettersi al wallet Phantom
        connectWalletButton.onclick = async () => {
            if (window.solana && window.solana.isPhantom) {
                try {
                    const response = await window.solana.connect();
                    walletAddress = response.publicKey.toString();
                    walletAddressDisplay.innerHTML = `Connected: ${walletAddress}`;
                    sendOrderButton.style.display = 'block';
                } catch (err) {
                    console.log(err);
                    alert("Error connecting to wallet.");
                }
            } else {
                alert("Please install Phantom Wallet.");
            }
        };

        // Funzione per inviare un ordine di trading
        sendOrderButton.onclick = async () => {
            if (!walletAddress) {
                alert("Please connect your wallet first.");
                return;
            }

            try {
                const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('devnet'), 'confirmed');
                const transaction = new solanaWeb3.Transaction();

                // Creazione e invio della transazione
                const { blockhash } = await connection.getRecentBlockhash();
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = walletAddress;

                // Logica per firmare e inviare la transazione
                const signedTransaction = await window.solana.signTransaction(transaction);
                const txid = await connection.sendRawTransaction(signedTransaction.serialize());

                alert(`Transaction sent: ${txid}`);
            } catch (err) {
                console.log(err);
                alert("Error sending order.");
            }
        };

        // Funzione per recuperare il prezzo di Bitcoin in tempo reale
        async function fetchBitcoinPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
                const data = await response.json();
                document.getElementById('bitcoin-price').innerText = `BTC/USD: $${data.bitcoin.usd}`;
            } catch (err) {
                console.error(err);
                document.getElementById('bitcoin-price').innerText = "Error fetching price.";
            }
        }

        // Aggiorna ogni 10 secondi
        setInterval(fetchBitcoinPrice, 10000);

        // Carica il prezzo all'avvio
        fetchBitcoinPrice();
    </script>
</body>
</html>
