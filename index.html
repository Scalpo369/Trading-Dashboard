<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Phantom Wallet SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-react@0.12.0"></script>
    <script>
        let connection;
        let wallet;

        // Connetti Phantom Wallet
        async function connectWallet() {
            if (window.solana && window.solana.isPhantom) {
                wallet = window.solana;
                await wallet.connect();
                document.getElementById('wallet-address').textContent = wallet.publicKey.toString();
                document.getElementById('connect-wallet').style.display = 'none';
                document.getElementById('disconnect-wallet').style.display = 'block';
                document.getElementById('wallet-info').style.display = 'flex';
            } else {
                alert('Phantom Wallet non trovato. Installa Phantom Wallet per connetterti.');
            }
        }

        // Disconnetti Phantom Wallet
        async function disconnectWallet() {
            if (wallet) {
                await wallet.disconnect();
                document.getElementById('wallet-address').textContent = 'Nessun wallet connesso';
                document.getElementById('connect-wallet').style.display = 'block';
                document.getElementById('disconnect-wallet').style.display = 'none';
                document.getElementById('wallet-info').style.display = 'none';
            }
        }

        // Funzione per ottenere i dati di mercato
        async function getMarketData() {
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd');
            const data = await response.json();

            document.getElementById('btc-price').textContent = `$${data.bitcoin.usd}`;
            document.getElementById('eth-price').textContent = `$${data.ethereum.usd}`;
            document.getElementById('sol-price').textContent = `$${data.solana.usd}`;
        }

        // Aggiorna i dati di mercato ogni 30 secondi
        setInterval(getMarketData, 30000);
        getMarketData();
    </script>
</head>
<body>
    <div class="dashboard">
        <h1>Trading Dashboard</h1>

        <!-- Wallet Connection -->
        <div class="wallet">
            <button id="connect-wallet" onclick="connectWallet()">Connetti Wallet Phantom</button>
            <button id="disconnect-wallet" onclick="disconnectWallet()" style="display: none;">Disconnetti Wallet</button>
        </div>
        
        <!-- Wallet Info -->
        <div id="wallet-info" class="wallet-info" style="display: none;">
            <p>Wallet connesso: <span id="wallet-address">Nessun wallet connesso</span></p>
        </div>

        <!-- Sezione Leva e Futures -->
        <div class="section leverage">
            <h2>Futures con Leva 2000x</h2>
            <p>Gestisci posizioni avanzate con leva fino a 2000x.</p>
            <button class="action-btn">Inizia Trading</button>
        </div>

        <!-- Sezione Prezzi di mercato -->
        <div class="section market-data">
            <h2>Market Data</h2>
            <div class="market-item">
                <h3>Bitcoin (BTC)</h3>
                <p id="btc-price">Loading...</p>
            </div>
            <div class="market-item">
                <h3>Ethereum (ETH)</h3>
                <p id="eth-price">Loading...</p>
            </div>
            <div class="market-item">
                <h3>Solana (SOL)</h3>
                <p id="sol-price">Loading...</p>
            </div>
        </div>

        <!-- Sezione Grafico Trading -->
        <div class="section chart">
            <h2>Grafico Prezzi</h2>
            <canvas id="priceChart" width="400" height="200"></canvas>
        </div>

        <!-- Sezione Ordini e Order Book -->
        <div class="section order-entry">
            <h2>Inserisci Ordine</h2>
            <form id="order-form">
                <label for="order-type">Tipo Ordine:</label>
                <select id="order-type">
                    <option value="buy">Compra</option>
                    <option value="sell">Vendi</option>
                </select>
                <br>
                <label for="order-amount">Quantità:</label>
                <input type="number" id="order-amount" placeholder="Quantità" required>
                <br>
                <label for="order-price">Prezzo:</label>
                <input type="number" id="order-price" placeholder="Prezzo" required>
                <br>
                <button class="action-btn" type="submit">Inserisci Ordine</button>
            </form>
        </div>

        <!-- Sezione Order Book -->
        <div class="section order-book">
            <h2>Order Book</h2>
            <table class="order-table">
                <tr><th>Tipo</th><th>Prezzo</th><th>Quantità</th></tr>
            </table>
        </div>
    </div>

    <!-- Script per Grafico -->
    <script>
        const ctx = document.getElementById('priceChart').getContext('2d');
        const priceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab', 'Dom'],
                datasets: [{
                    label: 'Prezzo BTC/USD',
                    data: [21000, 21500, 22000, 22500, 21800, 23000, 23500],
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                }
            }
        });

        // Gestione ordini
        document.getElementById('order-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const orderType = document.getElementById('order-type').value;
            const orderAmount = document.getElementById('order-amount').value;
            const orderPrice = document.getElementById('order-price').value;

            const orderTable = document.querySelector('.order-table');
            const newRow = orderTable.insertRow();
            const typeCell = newRow.insertCell(0);
            typeCell.textContent = orderType === 'buy' ? 'Compra' : 'Vendi';

            const priceCell = newRow.insertCell(1);
            priceCell.textContent = `$${orderPrice}`;

            const amountCell = newRow.insertCell(2);
            amountCell.textContent = orderAmount;

            document.getElementById('order-form').reset();
        });
    </script>
</body>
</html>
